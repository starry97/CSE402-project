!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s=2)}([function(t,e,n){(function(n){var o,r,i;r=[],void 0===(i="function"==typeof(o=function(){"use strict";function e(t,e,n){var o=new XMLHttpRequest;o.open("GET",t),o.responseType="blob",o.onload=function(){a(o.response,e,n)},o.onerror=function(){console.error("could not download file")},o.send()}function o(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function r(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(n){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,a=i.saveAs||("object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype?function(t,n,a){var s=i.URL||i.webkitURL,l=document.createElement("a");n=n||t.name||"download",l.download=n,l.rel="noopener","string"==typeof t?(l.href=t,l.origin===location.origin?r(l):o(l.href)?e(t,n,a):r(l,l.target="_blank")):(l.href=s.createObjectURL(t),setTimeout(function(){s.revokeObjectURL(l.href)},4e4),setTimeout(function(){r(l)},0))}:"msSaveOrOpenBlob"in navigator?function(t,n,i){if(n=n||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}(t,i),n);else if(o(t))e(t,n,i);else{var a=document.createElement("a");a.href=t,a.target="_blank",setTimeout(function(){r(a)})}}:function(t,n,o,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof t)return e(t,n,o);var a="application/octet-stream"===t.type,s=/constructor/i.test(i.HTMLElement)||i.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||a&&s)&&"object"==typeof FileReader){var d=new FileReader;d.onloadend=function(){var t=d.result;t=l?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=t:location=t,r=null},d.readAsDataURL(t)}else{var c=i.URL||i.webkitURL,u=c.createObjectURL(t);r?r.location=u:location.href=u,r=null,setTimeout(function(){c.revokeObjectURL(u)},4e4)}});i.saveAs=a.saveAs=a,t.exports=a})?o.apply(e,r):o)||(t.exports=i)}).call(this,n(1))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";n.r(e);const o="LSTM",r="Embedding",i="MaxPooling2D",a="__svg",s=["Dense","Conv2D",o,r,i],l=4,d="viz_container",c="__mviz",u="right",f="down",g=2,p=5,h=(d3.rgb(255,245,236),d3.rgb(253,186,134),d3.rgb(219,86,12)),m=d3.rgb(101,131,46),y=[d3.rgb(18,139,206),m,h,d3.rgb(253,181,7),d3.rgb(21,165,63)],w=75,b=50,v=50;function x(t,e="body"){const n=JSON.parse(t),o=d3.select(e).append("svg").attr("width",1200).attr("height",800).attr("id",a),r=t=>t.x+t.width/2,i=t=>t.y+t.height/2+g,l=d3.scaleOrdinal().domain(s).range(y),d=d3.drag().on("drag",function(t){t.x+=d3.event.dx,t.y+=d3.event.dy,d3.select(this).select("rect").attr("x",t.x).attr("y",t.y),d3.select(this).select("text").attr("x",r).attr("y",i),c.each(function(e){e.source==t.name?d3.select(this).select("line").attr("x1",e.dir==u?t.x+t.width:t.x+t.width/2).attr("y1",e.dir==u?t.y+t.height/2:t.y+t.height):e.destination==t.name&&d3.select(this).select("line").attr("x2",e.dir==u?t.x-p:t.x+t.width/2).attr("y2",e.dir==u?t.y+t.height/2:t.y-p)})}),c=o.selectAll("link").data(n.links).enter().append("g").attr("class","link");c.append("line").attr("x1",function(t){var e=n.nodes.filter(function(e){return e.name==t.source})[0];return t.dir==u?e.x+e.width:e.x+e.width/2}).attr("x2",function(t){var e=n.nodes.filter(function(e){return e.name==t.destination})[0];return t.dir==u?e.x-p:e.x+e.width/2}).attr("y1",function(t){var e=n.nodes.filter(function(e){return e.name==t.source})[0];return t.dir==u?e.y+e.height/2:e.y+e.height}).attr("y2",function(t){var e=n.nodes.filter(function(e){return e.name==t.destination})[0];return t.dir==u?e.y+e.height/2:e.y-p}).attr("fill","none").attr("stroke","black").attr("marker-end","url(#triangle)"),c.append("text").text(t=>t.text).attr("x",t=>t.x).attr("y",t=>t.y);var f=o.selectAll("node").data(n.nodes).enter().append("g").call(d);f.append("rect").attr("class","node").attr("x",t=>t.x).attr("y",t=>t.y).attr("width",t=>t.width).attr("height",t=>t.height).attr("fill",t=>"text"==t.shape?"none":t.fill||l(t.type)),f.append("text").attr("x",r).attr("y",i).text(t=>t.label).style("fill",t=>t.color||"black").style("text-anchor","middle"),o.append("svg:defs").append("svg:marker").attr("id","triangle").attr("refX",6).attr("refY",6).attr("markerWidth",30).attr("markerHeight",30).attr("orient","auto").append("path").attr("d","M 0 0 12 6 0 12 3 6").style("fill","black"),function(t){const e=t.node().getBBox();t.attr("width",e.x+e.width+100+"px"),t.attr("height",e.y+e.height+100+"px")}(o)}function E(t){const e=JSON.parse(t),{layers:n,attributes:o}=e,r={nodes:[],links:[]};let i=v,a=b,s=!1;for(let t=0;t<n.length;t++){const e=n[t],{name:d,type:c,subLayers:g}=e,p=g?g.length:1,h=e.connection;let m,y=0;for(let v=0;v<p;v++){let p={...o[c],...o[g?g[v]:d]},{text:x,...E}=p;x=x||["name"],m=p.shape||"rect",g&&(s=!0),s&&!g&&(console.log("shape is "+m),a=b+(p.width||L(m).width+w)*(l-1)),g&&(e.name=g[v]);const B=_(e,x,g,v);if("rect"==m?r.nodes.push({...L(m),x:a+y,y:i,label:B,...E,...e}):"text"==m&&r.nodes.push({...L(m),x:a+y,y:i,label:B,...E,...e}),g&&h>0&&v!=g.length-1&&r.links.push({source:g[v],destination:g[v+1],dir:u}),t!=n.length-1){const e=n[t+1];g&&!e.subLayers?v==g.length-1&&r.links.push({source:g?g[v]:d,destination:e.name,dir:f}):r.links.push({source:g?g[v]:d,destination:e.subLayers?e.subLayers[v]:e.name,dir:f})}y+=L(m).width+w}i+=L(m).height+w}return console.log(JSON.stringify(r)),JSON.stringify(r)}function _(t,e,n,o){let r="";if(e){for(let i=0;i<e.length;i++)"name"==e[i]&&n?r+=n[o]:r+=t[e[i]];return r}}function L(t){switch(t){case void 0:case"rect":return{x:0,y:0,width:150,height:50};case"text":return{x:0,y:0,width:150,height:20};default:throw new Error("unknown shape "+t)}}function B(t){const e=t.target.files[0];if(!e)throw new Error("Cannot read file");{const t=new FileReader;t.onloadend=function(t){const e=function(t){let e=t.split("\n"),n=[],a=new Set;for(let t=0;t<e.length;t++){let i=e[t];s.forEach(t=>{const e=i.split(/\s+/)[0];if(i.includes(t)){let i={name:e,type:t};if(t==r||t==o){let t=[];for(let n=1;n<=l;n++)t.push(e+"_"+n);i.subLayers=t}i.connection=t==o?1:0,n.push(i),a.add(t)}})}let d={};a.forEach(t=>{const e=t==i?"text":"rect";d[t]={shape:e,text:["name"]}});const c={layers:n,attributes:d};return console.log(JSON.stringify(c)),JSON.stringify(c)}(t.target.result);localStorage.setItem(c,e);const n=E(e);console.log(n),x(n,"#"+d)},t.readAsText(e)}}var k=n(0);function S(t){const e=parseInt(t.attributes.width.value),n=parseInt(t.attributes.height.value);!function(t,e,n,o){const r="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t))),i=document.createElement("canvas"),a=i.getContext("2d");i.width=e,i.height=n;const s=new Image;s.onload=function(){a.clearRect(0,0,e,n),a.drawImage(s,0,0,e,n),i.toBlob(function(t){const e=Math.round(t.length/1024)+" KB";o&&o(t,e)})},s.src=r}(j(t),2*e,2*n,function(t){Object(k.saveAs)(t,"MViz.png")})}function j(t){t.setAttribute("xlink","http://www.w3.org/1999/xlink"),function(t,e){const n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML=t;const o=e.hasChildNodes()?e.children[0]:null;e.insertBefore(n,o)}(function(t){const e=[];e.push("#"+t.id);for(let n=0;n<t.classList.length;n++)r("."+t.classList[n],e)||e.push("."+t.classList[n]);const n=t.getElementsByTagName("*");for(let t=0;t<n.length;t++){const o=n[t].id;r("#"+o,e)||e.push("#"+o);const i=n[t].classList;for(let t=0;t<i.length;t++)r("."+i[t],e)||e.push("."+i[t])}let o="";for(let t=0;t<document.styleSheets.length;t++){const n=document.styleSheets[t];try{if(!n.cssRules)continue}catch(t){if("SecurityError"!==t.name)throw t;continue}const i=n.cssRules;for(let t=0;t<i.length;t++)r(i[t].selectorText,e)&&(o+=i[t].cssText)}return o;function r(t,e){return-1!==e.indexOf(t)}}(t),t);let e=(new XMLSerializer).serializeToString(t);return e=(e=e.replace(/(\w+)?:?xlink=/g,"xmlns:xlink=")).replace(/NS\d+:href/g,"xlink:href")}function I(){if(document.getElementById("viz_container").innerHTML="",!document.getElementById("download_buttons").innerHTML){const t=document.createElement("button");t.setAttribute("id","download_svg"),t.innerHTML="Download as SVG";const e=document.createElement("button");e.setAttribute("id","download_png"),e.innerHTML="Download as PNG";const n=document.createElement("button");n.setAttribute("id","download_json"),n.innerHTML="Download MViz JSON",document.getElementById("download_buttons").appendChild(t),document.getElementById("download_buttons").appendChild(e),document.getElementById("download_buttons").appendChild(n),document.getElementById("download_png").addEventListener("click",()=>{S(document.getElementById(a))}),document.getElementById("download_svg").addEventListener("click",()=>{!function(t){const e=j(t);console.log(e);const n=new Blob([e],{type:"image/svg+xml"});Object(k.saveAs)(n,"MViz.svg")}(document.getElementById(a))}),document.getElementById("download_json").addEventListener("click",()=>{!function(t){console.log(t);const e=JSON.stringify(JSON.parse(t),null,2),n=new Blob([e],{type:"application/json"});Object(k.saveAs)(n,"MViz.json")}(localStorage.getItem(c))}),document.getElementById("download_png").classList.add("btn-sm"),document.getElementById("download_png").classList.add("btn-primary"),document.getElementById("download_svg").classList.add("btn-sm"),document.getElementById("download_svg").classList.add("btn-primary"),document.getElementById("download_json").classList.add("btn-sm"),document.getElementById("download_json").classList.add("btn-primary")}}document.getElementById("upload_summary_file").addEventListener("click",t=>{document.getElementById("upload_summary_file").value=null}),document.getElementById("upload_summary_file").addEventListener("change",t=>{B(t),I()}),document.getElementById("upload_json_file").addEventListener("click",t=>{document.getElementById("upload_json_file").value=null}),document.getElementById("upload_json_file").addEventListener("change",t=>{!function(t){console.log("handle file");const e=t.target.files[0];if(!e)throw new Error("Cannot read file");{const t=new FileReader;t.onloadend=function(t){const e=t.target.result;localStorage.setItem(c,e),x(E(e),"#"+d)},t.readAsText(e)}}(t),I()}),Split(["#one","#two"]).setSizes([25,70])}]);